<HTML>
<HEAD>
<TITLE>CUPS Software Administrators Manual</TITLE>
<META NAME="AUTHOR" CONTENT="Easy Software Products">
<META NAME="COPYRIGHT" CONTENT="Copyright 1997-1999, All Rights Reserved">
<META NAME="DOCNUMBER" CONTENT="CUPS-SAM-1.0.0">
</HEAD>
<BODY>
<CENTER><A HREF=#contents><IMG SRC="images/cups-large.gif" BORDER=0><BR>
<H1>CUPS Software Administrators Manual</H1></A><BR>
CUPS-SAM-1.0.0<BR>
Easy Software Products<BR>
Copyright 1997-1999, All Rights Reserved<BR>
</CENTER>
<HR>
<H1 ALIGN=CENTER><A NAME=CONTENTS>Table of Contents</A></H1>
<BR>
<BR><B><A HREF=#1>Preface</A></B>
<UL>
<LI><A HREF=#1_1>System Overview</A></LI>
<LI><A HREF=#1_2>Document Overview</A></LI>
</UL>
<B><A HREF=#2>1 - Printing System Overview</A></B>
<UL>
<LI><A HREF=#2_1>The Printing Problem</A></LI>
<LI><A HREF=#2_2>The Technology</A></LI>
<LI><A HREF=#2_3>Jobs</A></LI>
<LI><A HREF=#2_4>Classes</A></LI>
<LI><A HREF=#2_5>Filters</A></LI>
<LI><A HREF=#2_6>Printer Drivers</A></LI>
<LI><A HREF=#2_7>Networking</A></LI>
</UL>
<B><A HREF=#3>2 - Building and Installing CUPS</A></B>
<UL>
<LI><A HREF=#3_1>Installing a Source Distribution</A></LI>
<UL>
<LI><A HREF=#3_1_1>Requirements</A></LI>
<LI><A HREF=#3_1_2>Compiling CUPS</A></LI>
<LI><A HREF=#3_1_3>Installing the Software</A></LI>
<LI><A HREF=#3_1_4>Running the Software</A></LI>
</UL>
<LI><A HREF=#binary>Installing a Binary Distribution</A></LI>
</UL>
<B><A HREF=#4>3 - Printer Queue Management</A></B>
<UL>
<LI><A HREF=#4_1>The lpadmin Command</A></LI>
<LI><A HREF=#4_2>Adding and Modifying Printers</A></LI>
<UL>
<LI><A HREF=#4_2_1>Using Standard Printer Drivers</A></LI>
</UL>
<LI><A HREF=#4_3>Removing Printers</A></LI>
<LI><A HREF=#4_4>Printer Classes</A></LI>
<LI><A HREF=#4_5>Setting the Default Printer</A></LI>
<LI><A HREF=#4_6>Starting and Stopping Printers</A></LI>
<LI><A HREF=#4_7>Accepting and Rejecting Print Jobs</A></LI>
</UL>
<B><A HREF=#5>4 - Printing System Management</A></B>
<UL>
<LI><A HREF=#5_1>Changing the Configuration Files</A></LI>
<LI><A HREF=#5_2>Temporary Files</A></LI>
<LI><A HREF=#5_3>Network Configuration</A></LI>
<UL>
<LI><A HREF=#5_3_1>Port</A></LI>
<LI><A HREF=#5_3_2>Listen</A></LI>
<LI><A HREF=#5_3_3>BrowsePort</A></LI>
<LI><A HREF=#5_3_4>BrowseAddress</A></LI>
</UL>
<LI><A HREF=#5_4>Printer Security</A></LI>
<UL>
<LI><A HREF=#5_4_1>Location</A></LI>
<LI><A HREF=#5_4_2>Order</A></LI>
<LI><A HREF=#5_4_3>Allow</A></LI>
<LI><A HREF=#5_4_4>Deny</A></LI>
<LI><A HREF=#5_4_5>AuthType</A></LI>
<LI><A HREF=#5_4_6>AuthClass</A></LI>
<LI><A HREF=#5_4_7>AuthGroupName</A></LI>
<LI><A HREF=#5_4_8>SystemGroup</A></LI>
</UL>
<LI><A HREF=#5_5>File Formats</A></LI>
<UL>
<LI><A HREF=#5_5_1>mime.types</A></LI>
<LI><A HREF=#5_5_2>mime.convs</A></LI>
</UL>
</UL>
<B><A HREF=#6>5 - Printer Accounting</A></B>
<UL>
<LI><A HREF=#6_1>Where to Find the Log Files</A></LI>
<LI><A HREF=#6_2>The access_log File</A></LI>
<LI><A HREF=#6_3>The error_log File</A></LI>
<LI><A HREF=#6_4>The page_log File</A></LI>
</UL>
<HR>
<H1 ALIGN=RIGHT><A NAME=1>Preface</A></H1>
 This software administrators manual provides printer administration 
information for the Common UNIX Printing System (&quot;CUPS&quot;) Version 1.0.0. 
<H2><A NAME=1_1>System Overview</A></H2>
 The Common UNIX Printing System provides a portable printing layer for 
 UNIX&reg; operating systems. It has been developed by Easy Software 
 Products to promote a standard printing solution for all UNIX vendors 
 and users. CUPS provides the System V and Berkeley command-line 
interfaces. 
<P>CUPS uses the Internet Printing Protocol (IETF-IPP) as the basis for 
managing print jobs and queues. The Line Printer Daemon (LPD, RFC1179), 
Server Message Block (SMB), and AppSocket protocols are also supported 
with reduced functionality. </P>
<P>CUPS adds network printer browsing and PostScript Printer 
Description (&quot;PPD&quot;)-based printing options to support real world 
applications under UNIX. </P>
<P>CUPS also includes a customized version of GNU GhostScript 
(currently based off GNU GhostScript 4.03) and an image file RIP that 
can be used to support non-PostScript printers. </P>
<H2><A NAME=1_2>Document Overview</A></H2>
<P>This software administrators manual is organized into the following 
sections:</P>
<UL>
<LI>1 - Printing System Overview</LI>
<LI>2 - Building and Installing CUPS</LI>
<LI>3 - Printer Queue Management</LI>
<LI>4 - Printing System Management</LI>
<LI>5 - Printer Accounting</LI>
</UL>
<H1 ALIGN=RIGHT><A NAME=2>1 - Printing System Overview</A></H1>
<P>This chapter provides an overview of how the Common UNIX Printing 
System works. </P>
<H2><A NAME=2_1>The Printing Problem</A></H2>
<P>For years <I>the printing problem</I> has plagued UNIX&reg;. Unlike 
Microsoft&reg; Windows&reg; or MacOS, UNIX has no standard interface or system 
in place for supporting printers. Among the solutions previously 
available, the Berkeley and System V printing systems are the most 
prevalent. </P>
<P>These printing systems support line printers (text only) or 
PostScript printers (text and graphics), and with some coaxing they can 
be made to support a full range of printers and file formats. However, 
because each varient of the UNIX operating system uses a different 
printing system than the next, developing printer drivers for a wide 
range of printers is extremely difficult. That combined with the 
limited volume of customers for each UNIX varient has forced most 
printer vendors to give up supporting UNIX entirely. </P>
<P>The Common UNIX Printing System, or CUPS, is designed to eliminate <I>
the printing problem</I>. One common printing system can be used by all 
UNIX varients to support the printing needs of users. Printer vendors 
can use its modular filter interface to develop a single driver program 
that supports a wide range of file formats with little or no effort. 
 Since CUPS provides both the System V and Berkeley printing commands, 
users (and applications) can reap the benefits of this new technology 
with no changes. </P>
<H2><A NAME=2_2>The Technology</A></H2>
<P>CUPS is based upon an emerging Internet standard called the Internet 
Printing Protocol, or IPP. IPP has been embraced by dozens of printer 
and printer server manufacturers, and will be supported by the next 
Microsoft Windows operating system. </P>
<P>IPP defines a standard protocol for printing as well as managing 
print jobs and printer options like media size, resolution, and so 
forth. Like all IP-based protocols, IPP can be used locally or over the 
Internet to printers hundreds or thousands of miles away. Unlike other 
protocols, however, IPP also supports access control, authentication, 
and encryption, making it a much more secure printing solution than 
older ones. </P>
<P>IPP is layered on top of the Hyper-Text Transport Protocol, or HTTP, 
which is the basis of web servers on the Internet. This allows the user 
to view documentation and status information on a printer or server 
using their web browser. </P>
<P>CUPS provides a complete IPP/1.0-based printing system that provides 
Basic authentication and domain or IP-based access control. Digest 
authentication and TLS encryption will be available in future versions 
of CUPS. </P>
<H2><A NAME=2_3>Jobs</A></H2>
<P>Each file that is submitted for printing is called a <I>job</I>. 
 Jobs are identified by a unique number starting at 1 and are assigned 
to a particular destination (usually a printer). Jobs can also have 
options associated with them such as media size, number of copies, and 
priority. </P>
<H2><A NAME=2_4>Classes</A></H2>
<P>CUPS supports collections of printers known as <I>classes</I>. Jobs 
sent to a class are forwarded to the first available printer in the 
class. </P>
<H2><A NAME=2_5>Filters</A></H2>
<P>Filters allow a user or application to print many types of files 
without extra effort. Print jobs sent to a CUPS server are filtered 
before sending them to a printer. Some filters convert job files to 
different formats that the printer can understand. Others perform page 
selection and ordering tasks. <I>Backend</I> filters perform the most 
important task of all - they send the filtered print data to the 
printer. </P>
<P>CUPS provides filters for printing many types of image files, 
HP-GL/2 files, PDF files, and text files. CUPS also supplies PostScript 
and image file Raster Image Processors, or RIPs, that convert 
PostScript or image files into bitmaps that can be sent to a raster 
printer. </P>
<P>CUPS provides backends for printing over parallel and serial ports, 
and over the network via the JetDirect (AppSocket), Server Message 
Block, and Line Printer Daemon protocols. </P>
<H2><A NAME=2_6>Printer Drivers</A></H2>
<P>Printer drivers in CUPS consist of one of more filters specific to a 
printer. CUPS includes a sample printer driver for Hewlett-Packard 
LaserJet and DeskJet printers. While this driver does not generate 
optimal output for different printer models, it does demonstrate how 
you can write your own printer drivers and incorporate them into CUPS. </P>
<H2><A NAME=2_7>Networking</A></H2>
<P>Printers and classes on the local system are automatically shared 
with other systems on the network. This allows you to setup one system 
to print to a printer and use this system as a printer server or spool 
host for all of the others.  If there is only one occurrence of a 
printer on a network, then that printer can be accessed using its name 
alone. If more than one printer exists with the same name, users must 
select the printer by specifying which server to use (e.g. 
&quot;printer@host1&quot; or &quot;printer@host2&quot;.) </P>
<P>CUPS also provides <I>implicit classes</I>, which are collections of 
printers and/or classes with the same name. This allows you to setup 
multiple servers pointing to the same physical network printer, for 
example, so that you aren't relying on a single system for printing. 
Because this also works with printer classes, you can setup multiple 
servers and printers and never worry about a &quot;single point of failure&quot; 
unless all of the printers and servers goes down! </P>
<H1 ALIGN=RIGHT><A NAME=3>2 - Building and Installing CUPS</A></H1>
<P>This chapter shows how to build and install the Common UNIX Printing 
System. If you are installing a binary distribution from the CUPS web 
site, proceed to the section titled, <A HREF=#binary>Installing a 
Binary Distribution</A>. </P>
<H2><A NAME=3_1>Installing a Source Distribution</A></H2>
<H3><A NAME=3_1_1>Requirements</A></H3>
<P>You'll need an ANSI C compiler to build CUPS on your system. As its 
name implies, CUPS is designed to run on the UNIX operating system, 
however the CUPS interface library and most of the filters and backends 
supplied with CUPS should also run under Microsoft&reg; Windows&reg;. </P>
<P>For the image file filters and PostScript RIP, you'll need the JPEG, 
PNG, TIFF, and ZLIB libraries. CUPS will build without these, but with 
reduced functionality. Easy Software Products maintains a mirror of the 
current versions of these libraries at: </P>
<UL>
<PRE>
<A HREF=ftp://ftp.easysw.com/pub/libraries>ftp://ftp.easysw.com/pub/libraries</A>
</PRE>
</UL>
<P>If you make changes to the man pages you'll need GNU groff or 
another nroff-like package. GNU groff is available from: </P>
<UL>
<PRE>
<A HREF=ftp://ftp.gnu.org/pub/groff>ftp://ftp.gnu.org/pub/groff</A>
</PRE>
</UL>
<P>The documentation is formatted using the HTMLDOC software. If you 
need to make changes you can get the HTMLDOC software from: </P>
<UL>
<PRE>
<A HREF=http://www.easysw.com/htmldoc>http://www.easysw.com/htmldoc</A>
</PRE>
</UL>
<H3><A NAME=3_1_2>Compiling CUPS</A></H3>
<P>CUPS uses GNU autoconf to configure the makefiles and source code 
for your system. To configure CUPS for your system type: </P>
<UL>
<PRE>
% ./configure ENTER
</PRE>
</UL>
<P>The default installation will put the CUPS software in the <CODE>/usr</CODE>
 and <CODE>/var</CODE> directories on your system, which will overwrite 
any existing printing commands on your system. To install the CUPS 
software in another location use the <CODE>--prefix</CODE> option: </P>
<UL>
<PRE>
% ./configure --prefix=/usr/local ENTER
</PRE>
</UL>
<P>If the PNG, JPEG, TIFF, and ZLIB libraries are not installed in a 
system default location (typically <CODE>/usr/include</CODE> and <CODE>
/usr/lib</CODE>) you'll need to set the <CODE>CFLAGS</CODE> and <CODE>
LDFLAGS</CODE> environment variables prior to running configure: </P>
<UL>
<PRE>
% setenv CFLAGS &quot;-I/some/directory&quot;
% setenv LDFLAGS &quot;-L/some/directory&quot;
% ./configure ... ENTER
</PRE>
</UL>
<P>Once you have configured things, just type: </P>
<UL>
<PRE>
% make ENTER
</PRE>
</UL>
<P>to build the software. </P>
<H3><A NAME=3_1_3>Installing the Software</A></H3>
<P>To install the software type: </P>
<UL>
<PRE>
% make install ENTER
</PRE>
</UL>
<H3><A NAME=3_1_4>Running the Software</A></H3>
 Once you have installed the software you can start the CUPS daemon by 
typing: 
<UL>
<PRE>
% /usr/sbin/cupsd &amp; ENTER
</PRE>
</UL>
<H2><A NAME=binary>Installing a Binary Distribution</A></H2>
<P>We are currently distributing CUPS binary distributions in TAR 
format with installation and removal scripts. </P>
<UL><B>WARNING:</B>
<P>Installing CUPS will overwrite your existing printing  system. If 
you experience difficulties with the CUPS software  and need to go back 
to your old printing system, you will need  to remove the CUPS software 
with the provided script and  reinstall the printing system from your 
operating system CDs. </P>
</UL>
<P>To install the CUPS software you will need to be logged in as root 
(doing an &quot;su&quot; is good enough). Once you are the root user, run the 
installation script with: </P>
<UL>
<PRE>
./cups.install ENTER
</PRE>
</UL>
<P>After asking you a few yes/no questions the CUPS software will be 
installed and the scheduler will be started automatically. </P>
<H1 ALIGN=RIGHT><A NAME=4>3 - Printer Queue Management</A></H1>
<P>This chapter discusses how to add, modify, and delete print queues 
on your system. </P>
<H2><A NAME=4_1>The lpadmin Command</A></H2>
<P>The <CODE>lpadmin</CODE> command allows you to perform most printer 
administration tasks from the command-line. Since <CODE>lpadmin</CODE>
 is also a System V printing system command, it is located in the <CODE>
/usr/lib</CODE> directory instead of a more common one like <CODE>
/usr/bin</CODE> or <CODE>/usr/sbin</CODE>. </P>
<H2><A NAME=4_2>Adding and Modifying Printers</A></H2>
<P>To add a printer to CUPS you simply run the <CODE>lpadmin</CODE>
 command with the &quot;-p&quot; option: </P>
<UL>
<PRE>
% /usr/lib/lpadmin -p<I>printer</I> -E -v<I>device</I> -P<I>ppd</I> ENTER
</PRE>
</UL>
<P>Spaces between the option letter and value are optional. </P>
<P>The <I>printer</I> name can be up to 127 letters, digits, hyphens, 
and underscores. Unlike other printing systems, the printer name in 
CUPS is <I>not</I> case-sensitive, so you can't add two printers named <CODE>
LaserJet</CODE> and <CODE>laserjet</CODE>. </P>
<P>The <I>device</I> argument specifies the device URI or filename for 
the printer. The following devices are supported in a basic 
installation of CUPS: </P>
<DL>
<DT>file:/dev/filename </DT>
<DT>/dev/filename </DT>
<DD>Sends all output to the specified file. </DD>
<DT>http://[username:password@]hostname[:port]/resource </DT>
<DT>ipp://[username:password@]hostname[:port]/resource </DT>
<DD>Sends all output to the specified IPP printer or server.  The <I>
port</I> parameters defaults to 631. </DD>
<DT>lpd://hostname/queue </DT>
<DD>Sends all output to the specified LPD printer queue. </DD>
<DT>parallel:/dev/filename </DT>
<DD>Sends all output to the specified parallel port device. </DD>
<DT>serial:/dev/filename[?options] </DT>
<DD>Sends all output to the specified serial port device.  The <I>
options</I> can be any of the following separated by the  plus (+) 
character: 
<UL>
<LI><CODE>baud=<I>rate</I></CODE> - Sets the baud rate  for the device. </LI>
<LI><CODE>bits=<I>7 or 8</I></CODE> - Sets the number  of data bits. </LI>
<LI><CODE>parity=<I>even</I></CODE> - Sets even parity  checking. </LI>
<LI><CODE>parity=<I>odd</I></CODE> - Sets odd parity  checking. </LI>
<LI><CODE>parity=<I>none</I></CODE> - Turns parity  checking off. </LI>
</UL>
</DD>
<DT>smb://[username:password@]hostname/queue </DT>
<DD>Sends all output to the specified SMB (Windows) printer queue 
 using the SAMBA software. </DD>
<DT>socket://hostname[:port] </DT>
<DD>Sends all output to the specified printer using the  AppSocket 
protocol. The <I>port</I> parameter defaults to 9100. </DD>
</DL>
<P>The <I>ppd</I> argument specifies the PostScript Printer Description 
file to use for this printer. Many options (such as media size, etc.) 
will not be available if you omit this part of the <CODE>lpadmin</CODE>
 command. </P>
<H3><A NAME=4_2_1>Using Standard Printer Drivers</A></H3>
<P>The <CODE>lpadmin</CODE> command allows you to use &quot;standard&quot; PPD 
files and interface scripts located in the <CODE>/usr/share/cups/model</CODE>
 directory with the &quot;-m&quot; option: </P>
<UL>
<PRE>
% /usr/lib/lpadmin -p<I>printer</I> -E -v<I>device</I> -m<I>model</I> ENTER
</PRE>
</UL>
<P>The <I>model</I> argument specifies the name of the PPD file or 
interface script. For example, to add a printer using the sample HP 
DeskJet series driver connected to parallel port 1 under Linux you 
would use: </P>
<UL>
<PRE>
% /usr/lib/lpadmin -pDeskJet -E -vparallel:/dev/par1 -mdeskjet.ppd ENTER
</PRE>
</UL>
<H2><A NAME=4_3>Removing Printers</A></H2>
<P>To remove a printer to CUPS you simply run the <CODE>lpadmin</CODE>
 command with the &quot;-x&quot; option: </P>
<UL>
<PRE>
% /usr/lib/lpadmin -x<I>printer</I> ENTER
</PRE>
</UL>
<H2><A NAME=4_4>Printer Classes</A></H2>
<P>CUPS allows you to group similar printers in a <I>printer class</I>. 
When a user sends a print job to a class, the job will be processed by 
the first available printer in that class. </P>
<P>To add a printer to a class you simply run the <CODE>lpadmin</CODE>
 command with the &quot;-p&quot; and &quot;-c&quot; options: </P>
<UL>
<PRE>
% /usr/lib/lpadmin -p<I>printer</I> -c<I>class</I> ENTER
</PRE>
</UL>
<P>The <I>class</I> is created automatically if it doesn't exist. To 
remove a class just use the &quot;-x&quot; option: </P>
<UL>
<PRE>
% /usr/lib/lpadmin -x<I>class</I> ENTER
</PRE>
</UL>
<H2><A NAME=4_5>Setting the Default Printer</A></H2>
<P>To set the default printer or class simply run the <CODE>lpadmin</CODE>
 command with the &quot;-d&quot; option: </P>
<UL>
<PRE>
% /usr/lib/lpadmin -d<I>destination</I> ENTER
</PRE>
</UL>
<P>The <I>destination</I> argument is the name of the printer or class. </P>
<H2><A NAME=4_6>Starting and Stopping Printers</A></H2>
<P>The <CODE>enable</CODE> and <CODE>disable</CODE> commands start and 
stop printer queues, respectively: </P>
<UL>
<PRE>
% /usr/bin/enable <I>printer</I> ENTER
% /usr/bin/disable <I>printer</I> ENTER
</PRE>
</UL>
<P>Printers that are disabled may still accept jobs for printing, but 
won't actually print any files until they are restarted. This is useful 
if the printer malfunctions and you need time to correct the problem. 
Any queues jobs are printed after the printer is enabled (started). </P>
<H2><A NAME=4_7>Accepting and Rejecting Print Jobs</A></H2>
<P>The <CODE>accept</CODE> and <CODE>reject</CODE> commands accept and 
reject print jobs for the named printer, respectively: </P>
<UL>
<PRE>
% /usr/lib/accept <I>printer</I> ENTER
% /usr/lib/reject <I>printer</I> ENTER
</PRE>
</UL>
<P>As noted above, a printer can be stopped but accepting new print 
jobs. A printer can also be rejecting new print jobs while it finishes 
those that have been queued. This is useful for when you must perform 
maintenance on the printer and will not have it available to users for 
a long period of time. </P>
<H1 ALIGN=RIGHT><A NAME=5>4 - Printing System Management</A></H1>
<P>This chapter shows how you can configure the CUPS server. </P>
<H2><A NAME=5_1>Changing the Configuration Files</A></H2>
<P>All of the server configuration files are located in the <CODE>
/var/cups/conf</CODE> directory. Once you have made a change to a file 
you need to restart the CUPS server by sending it a HUP signal or using 
the supplied script &quot;<CODE>cups.sh</CODE>&quot;: </P>
<UL>
<PRE>
% ./cups.sh restart ENTER
</PRE>
</UL>
<P>The binary distribution installs the script in the <CODE>init.d</CODE>
 directory with the name <CODE>lp</CODE> or <CODE>lpd</CODE> depending 
on the vendor-supplied printing system. </P>
<H2><A NAME=5_2>Temporary Files</A></H2>
<P>Normally CUPS puts all of its temporary files in <CODE>/var/tmp</CODE>
. If you'd like to change this directory you'll need to edit the <CODE>
/var/cups/conf/cupsd.conf</CODE> file. </P>
<P>Start by creating the new temporary directory and setting the 
appropriate permissions: </P>
<UL>
<PRE>
% mkdir <I>/foo/bar/tmp</I> ENTER
% chmod a+rwxt <I>/foo/bar/tmp</I> ENTER
</PRE>
</UL>
<P>Then change the line containing the <CODE>TempDir</CODE> directive 
in the <CODE>cupsd.conf</CODE> to the directory that you've created: </P>
<UL>
<PRE>
TempDir <I>/foo/bar/tmp</I>
</PRE>
</UL>
<P>Finally, restart the server as outlined in the first section of this 
chapter. </P>
<H2><A NAME=5_3>Network Configuration</A></H2>
<P>The default configuration of the CUPS server listens for connections 
from all network interfaces on port 631 (the standard IPP port). 
Administration functions are limited to local connections with the 
appropriate username and password. </P>
<P>If you'd like to limit access to your system you'll need to edit the <CODE>
/var/cups/conf/cupsd.conf</CODE> file. </P>
<H3><A NAME=5_3_1>Port</A></H3>
<P>The <CODE>Port</CODE> directive specifies a port to listen on for 
all interfaces. Besides the standard IPP port (631) you can also setup 
your server to listen on the HTTP port (80) to use your CUPS server as 
a standard web server as well. </P>
<H3><A NAME=5_3_2>Listen</A></H3>
<P>The <CODE>Listen</CODE> directive specifies a listening address and 
port, extending the functionality of the <CODE>Port</CODE> directive. 
If you want to allow connections only from the local machine you can 
use: </P>
<UL>
<PRE>
Listen 127.0.0.1:631
</PRE>
</UL>
<P>instead of the <CODE>Port</CODE> directive. </P>
<P>If you want to limit access to a specific network/subnet, make sure 
you specify only the network address and not your system's network 
address! </P>
<H3><A NAME=5_3_3>BrowsePort</A></H3>
<P>The <CODE>BrowsePort</CODE> directive controls which port is 
monitored for remote printers. By default it is set to the IPP port 
(631), however you can change it as needed. </P>
<UL><B>NOTE:</B>
<P>You must set the <CODE>BrowsePort</CODE> to the same value  on all 
of the systems that you want to see. </P>
</UL>
<H3><A NAME=5_3_4>BrowseAddress</A></H3>
<P>The <CODE>BrowseAddress</CODE> directive specifies a broadcast 
address to use when sending printer status updates over the network. 
The default browse address is <CODE>255.255.255.255</CODE> which will 
send printer information to all subnets. </P>
<UL><B>NOTE:</B>
<P>If you are using HP-UX 10.20 and a subnet that is not 24,  16, or 8 
bits, printer browsing (and in fact all broadcast  reception) will not 
work. This problem appears to be fixed in  HP-UX 11.0. </P>
</UL>
<H2><A NAME=5_4>Printer Security</A></H2>
<P>CUPS provides IP and domain-name based access control and Basic 
authentication for authentication. </P>
<H3><A NAME=5_4_1>Location</A></H3>
<P>The <CODE>Location</CODE> directive defines access control for a 
specific HTTP directory. The following pseudo directories are provided 
by the CUPS server: </P>
<UL>
<LI><CODE>/admin</CODE> - This is the URI that must be referenced to 
 do printer administation commands. </LI>
<LI><CODE>/classes</CODE> - This is the URI that must be referenced to 
 access printer classes. </LI>
<LI><CODE>/jobs</CODE> - This is the URI that must be referenced to 
 access jobs. </LI>
<LI><CODE>/printers</CODE> - This is the URI that must be referenced to 
 access printers. </LI>
</UL>
<P>All other directories are taken from the <CODE>/usr/share/cups/doc</CODE>
 directory. </P>
<P>The <CODE>Location</CODE> directive surrounds the other access 
control directives described below. The default server configuration 
uses: </P>
<UL>
<PRE>
&lt;Location /admin&gt;
AuthType Basic
AuthClass System

Order Deny,Allow
Deny From All
Allow From 127.0.0.1
&lt;/Location&gt;
</PRE>
</UL>
<H3><A NAME=5_4_2>Order</A></H3>
<P>The <CODE>Order</CODE> directive defines the default access control. 
The following values are supported: </P>
<UL>
<LI><CODE>Order Allow,Deny</CODE> - Allow requests from all  systems <I>
except</I> for those listed in a <CODE>Deny</CODE> directive. </LI>
<LI><CODE>Order Deny,Allow</CODE> - Allow requests only from  those 
listed in an <CODE>Allow</CODE> directive. </LI>
</UL>
<P>The <CODE>Order</CODE> directive must appear inside a <CODE>Location</CODE>
 directive. </P>
<H3><A NAME=5_4_3>Allow</A></H3>
<P>The <CODE>Allow</CODE> directive specifies a hostname, IP address, 
or network that is allowed access to the server: </P>
<UL>
<PRE>
Allow from All
Allow from None
Allow from *.domain.com
Allow from .domain.com
Allow from host.domain.com
Allow from nnn.*
Allow from nnn.nnn.*
Allow from nnn.nnn.nnn.*
Allow from nnn.nnn.nnn.nnn
Allow from nnn.nnn.nnn.nnn/mm
Allow from nnn.nnn.nnn.nnn/mmm.mmm.mmm.mmm
</PRE>
</UL>
<P><CODE>Allow</CODE> directives are cummulative, so multiple <CODE>
Allow</CODE> directives can be used to allow access for multiple hosts 
or networks.  The <CODE>/mm</CODE> notation specifies a CIDR netmask: 
<CENTER>
<TABLE BORDER=1 WIDTH=80%>
<TR><TH>mm</TH><TH>netmask</TH></TR>
<TR><TD>0</TD><TD>0.0.0.0</TD></TR>
<TR><TD>1</TD><TD>128.0.0.0</TD></TR>
<TR><TD>2</TD><TD>192.0.0.0</TD></TR>
<TR><TD>...</TD><TD>...</TD></TR>
<TR><TD>8</TD><TD>255.0.0.0</TD></TR>
<TR><TD>16</TD><TD>255.255.0.0</TD></TR>
<TR><TD>24</TD><TD>255.255.255.0</TD></TR>
<TR><TD>32</TD><TD>255.255.255.255</TD></TR>
</TABLE>
</CENTER>
</P>
<P>The <CODE>Allow</CODE> directive must appear inside a <CODE>Location</CODE>
 directive. </P>
<H3><A NAME=5_4_4>Deny</A></H3>
<P>The <CODE>Deny</CODE> directive specifies a hostname, IP address, or 
network that is allowed access to the server: </P>
<UL>
<PRE>
Deny from All
Deny from None
Deny from *.domain.com
Deny from .domain.com
Deny from host.domain.com
Deny from nnn.*
Deny from nnn.nnn.*
Deny from nnn.nnn.nnn.*
Deny from nnn.nnn.nnn.nnn
Deny from nnn.nnn.nnn.nnn/mm
Deny from nnn.nnn.nnn.nnn/mmm.mmm.mmm.mmm
</PRE>
</UL>
<P><CODE>Deny</CODE> directives are cummulative, so multiple <CODE>Deny</CODE>
 directives can be used to allow access for multiple hosts or networks. 
 The <CODE>/mm</CODE> notation specifies a CIDR netmask: 
<CENTER>
<TABLE BORDER=1 WIDTH=80%>
<TR><TH>mm</TH><TH>netmask</TH></TR>
<TR><TD>0</TD><TD>0.0.0.0</TD></TR>
<TR><TD>1</TD><TD>128.0.0.0</TD></TR>
<TR><TD>2</TD><TD>192.0.0.0</TD></TR>
<TR><TD>...</TD><TD>...</TD></TR>
<TR><TD>8</TD><TD>255.0.0.0</TD></TR>
<TR><TD>16</TD><TD>255.255.0.0</TD></TR>
<TR><TD>24</TD><TD>255.255.255.0</TD></TR>
<TR><TD>32</TD><TD>255.255.255.255</TD></TR>
</TABLE>
</CENTER>
</P>
<P>The <CODE>Deny</CODE> directive must appear inside a <CODE>Location</CODE>
 directive. </P>
<H3><A NAME=5_4_5>AuthType</A></H3>
<P>The <CODE>AuthType</CODE> directive defines the type of 
authentication to perform: </P>
<UL>
<LI><CODE>None</CODE> - No authentication should be performed 
 (default.) </LI>
<LI><CODE>Basic</CODE> - Basic authentication should be  performed 
using the UNIX password and group files. </LI>
</UL>
<P>The <CODE>AuthType</CODE> directive must appear inside a <CODE>
Location</CODE> directive. </P>
<H3><A NAME=5_4_6>AuthClass</A></H3>
<P>The <CODE>AuthClass</CODE> directive defines what level of <CODE>
Basic</CODE> access is required: </P>
<UL>
<LI><CODE>Anonymous</CODE> - No authentication should be performed 
 (default.) </LI>
<LI><CODE>User</CODE> - A valid username and password is required. </LI>
<LI><CODE>System</CODE> - A valid username and password is  required, 
and the username must belong to the &quot;sys&quot; group (this  can be changed 
using the <CODE>SystemGroup</CODE> directive,  below. </LI>
<LI><CODE>Group</CODE> - A valid username and password is  required, 
and the username must belong to the group named by  the <CODE>
AuthGroupName</CODE> directive. </LI>
</UL>
<P>The <CODE>AuthClass</CODE> directive must appear inside a <CODE>
Location</CODE> directive. </P>
<H3><A NAME=5_4_7>AuthGroupName</A></H3>
<P>The <CODE>AuthGroupName</CODE> directive sets the group to use for <CODE>
Group</CODE> authentication. </P>
<P>The <CODE>AuthGroupName</CODE> directive must appear inside a <CODE>
Location</CODE> directive. </P>
<H3><A NAME=5_4_8>SystemGroup</A></H3>
<P>The <CODE>SystemGroup</CODE> directive sets the administration group 
used when authenticating the <CODE>System</CODE> type. It defaults to 
the &quot;sys&quot; group. </P>
<H2><A NAME=5_5>File Formats</A></H2>
<P>CUPS provides a MIME-based file typing and filtering mechanism to 
convert files to a printable format for each printer. The <CODE>
mime.types</CODE> and <CODE>mime.convs</CODE> files define the file 
type and filters that are available on the system. </P>
<H3><A NAME=5_5_1>mime.types</A></H3>
<P>The <CODE>mime.types</CODE> defines the known file types. Each line 
of the file starts with the MIME type and may be followed by one or 
more file type recognition rules. For example, the <CODE>text/html</CODE>
 file type is defined as: </P>
<UL>
<PRE>
text/html html htm \
          printable(0,1024) + (string(0,&quot;&lt;HTML&gt;&quot;) string(0,&quot;&lt;!DOCTYPE&quot;))
</PRE>
</UL>
<P>The first two rules say that any file with an extension of &quot;.html&quot; 
or &quot;.htm&quot; is a HTML file. The third rules says that any file whose 
first 1024 characters are printable text and starts with the strings 
&quot;&lt;HTML&gt;&quot; or &quot;&lt;!DOCTYPE&quot; is a HTML file as well. </P>
<P>The first two rules deal solely with the name of the file being 
typed. This is useful when the original filename is known, however for 
print files the server doesn't always have a filename to work with. The 
third rule takes care of this possibility and automatically figures out 
the file type based upon the contents of the file instead. </P>
<P>The available tests are: </P>
<UL>
<LI><CODE>( expr )</CODE> - Parenthesis for expression grouping </LI>
<LI><CODE>+</CODE> - Logical AND </LI>
<LI><CODE>,</CODE> or whitespace - Logical OR </LI>
<LI><CODE>!</CODE> - Logical NOT </LI>
<LI><CODE>match(&quot;pattern&quot;)</CODE> - Pattern match on filename </LI>
<LI><CODE>extension</CODE> - Pattern match on &quot;*.extension&quot; </LI>
<LI><CODE>ascii(offset,length)</CODE> - True if bytes are valid 
 printable ASCII (CR, NL, TAB, BS, 32-126) </LI>
<LI><CODE>printable(offset,length)</CODE> - True if bytes are 
 printable 8-bit chars (CR, NL, TAB, BS, 32-126, 160-254) </LI>
<LI><CODE>string(offset,&quot;string&quot;)</CODE> - True if bytes are  identical 
to string </LI>
<LI><CODE>char(offset,value)</CODE> - True if byte is identical </LI>
<LI><CODE>short(offset,value)</CODE> - True if 16-bit integer  is 
identical (network or &quot;big-endian&quot; byte order) </LI>
<LI><CODE>int(offset,value)</CODE> - True if 32-bit integer is 
 identical (network or &quot;big-endian&quot; byte order) </LI>
<LI><CODE>locale(&quot;string&quot;)</CODE> - True if current locale  matches 
string </LI>
</UL>
<H3><A NAME=5_5_2>mime.convs</A></H3>
<P>The <CODE>mime.convs</CODE> file defines all of the filter programs 
that are known to the system. Each line consists of: </P>
<UL>
<PRE>
source destination cost program

text/plain application/postscript 50 texttops
application/vnd.cups-postscript application/vnd.cups-raster 50 pstoraster
image/* application/vnd.cups-postscript 50 imagetops
image/* application/vnd.cups-raster 50 imagetoraster
</PRE>
</UL>
<P>The <I>source</I> field is a MIME type, optionally using a wildcard 
for the super-type or sub-type (e.g. &quot;text/plain&quot;, &quot;image/*&quot;, 
&quot;*/postscript&quot;). </P>
<P>The <I>destination</I> field is a MIME type defined in the <CODE>
mime.types</CODE> file. </P>
<P>The <I>cost</I> field defines a relative cost for the filtering 
operation from 1 to 100. The cost is used to choose between two 
different sets of filters when converting a file. For example, to 
convert from <CODE>image/jpeg</CODE> to <CODE>
application/vnd.cups-raster</CODE>, you could use the <CODE>imagetops</CODE>
 and <CODE>pstoraster</CODE> filters for a total cost of 100, or the <CODE>
imagetoraster</CODE> filter for a total cost of 50. </P>
<P>The <I>program</I> field defines the filter program to run; the 
special program &quot;-&quot; can be used to make two file types equivalent. The 
program must accept the standard filter arguments and environment 
variables described in the CUPS Interface Design Document: </P>
<UL>
<PRE>
program job user title options [filename]
</PRE>
</UL>
<P>If specified, the <I>filename</I> argument defines a file to read 
when filtering, otherwise the filter must read from the standard input. 
All filtered output must go to the standard output. </P>
<H1 ALIGN=RIGHT><A NAME=6>5 - Printer Accounting</A></H1>
 This chapter describes the CUPS log files. 
<H2><A NAME=6_1>Where to Find the Log Files</A></H2>
<P>The log files are normally stored in the <CODE>/var/cups/logs</CODE>
 directory. You can change this by editing the <CODE>
/var/cups/conf/cupsd.conf</CODE> configuration file. </P>
<H2><A NAME=6_2>The access_log File</A></H2>
<P>The <CODE>access_log</CODE> file lists each HTTP resource that is 
accessed by a web browser or CUPS/IPP client. Each line is in the 
so-called &quot;Common Log Format&quot; used by many web servers and web 
reporting tools: </P>
<UL>
<PRE>
host group user date-time \&quot;method resource version\&quot; status bytes

127.0.0.1 - - [20/May/1999:19:20:29 +0000] &quot;POST /admin/ HTTP/1.1&quot; 401 0
127.0.0.1 - mike [20/May/1999:19:20:31 +0000] &quot;POST /admin/ HTTP/1.1&quot; 200 0
</PRE>
</UL>
<P>The <I>host</I> field will normally only be an IP address unless you 
have changed the <CODE>HostnameLookups</CODE> directive on in the <CODE>
cupsd.conf</CODE> file. </P>
<P>The <I>group</I> field always contains &quot;-&quot;. </P>
<P>The <I>user</I> field is the authenticated username of the 
requesting user. If no username and password is supplied for the 
request then this field contains &quot;-&quot;. </P>
<P>The <I>date-time</I> field is the date and time of the request in 
Greenwich Mean Time (a.k.a. ZULU) and is in the format: </P>
<UL>
<PRE>
[DD/MON/YYYY:HH:MM:SS +0000]
</PRE>
</UL>
<P>The <I>method</I> field is the HTTP method used (&quot;GET&quot;, &quot;PUT&quot;, 
&quot;POST&quot;, etc.) </P>
<P>The <I>resource</I> field is the filename of the requested resource. </P>
<P>The <I>version</I> field is the HTTP specification version used by 
the client. For CUPS clients this will always be &quot;HTTP/1.1&quot;. </P>
<P>The <I>status</I> field contains the HTTP result status of the 
request. Usually it is &quot;200&quot;, but other HTTP status codes are possible. 
For example, 401 is the &quot;unauthorized access&quot; status in the example 
above. </P>
<P>The <I>bytes</I> field contains the number of bytes in the request. 
For POST requests the <I>bytes</I> field contains the number of bytes 
of non-IPP data that is received from the client. </P>
<H2><A NAME=6_3>The error_log File</A></H2>
<P>The <CODE>error_log</CODE> file lists messages from the scheduler 
(errors, warnings, etc.): </P>
<UL>
<PRE>
level date-time message

I [20/May/1999:19:18:28 +0000] Job 1 queued on 'DeskJet' by 'mike'.
I [20/May/1999:19:21:02 +0000] Job 2 queued on 'DeskJet' by 'mike'.
I [20/May/1999:19:22:24 +0000] Job 2 was cancelled by 'mike'.
</PRE>
</UL>
<P>The <I>level</I> field contains the type of message: </P>
<UL>
<LI><CODE>E</CODE> - An error occurred. </LI>
<LI><CODE>W</CODE> - The server was unable to perform some action. </LI>
<LI><CODE>I</CODE> - Informational message. </LI>
<LI><CODE>D</CODE> - Debugging message. </LI>
</UL>
<P>The <I>date-time</I> field contains the date and time of when the 
page started printing. The format of this field is identical to the <I>
data-time</I> field in the <CODE>access_log</CODE> file. </P>
<P>The <I>message</I> fields contains a free-form textual message. </P>
<H2><A NAME=6_4>The page_log File</A></H2>
<P>The <CODE>page_log</CODE> file lists each page that is sent to a 
printer. Each line contains the following information: </P>
<UL>
<PRE>
printer user job-id date-time page-number num-copies

DeskJet root 2 [20/May/1999:19:21:05 +0000] 1 0
</PRE>
</UL>
<P>The <I>printer</I> field contains the name of the printer that 
printed the page. If you send a job to a printer class, this field will 
contain the name of the printer that was assigned the job. </P>
<P>The <I>user</I> field contains the name of the user (the IPP <CODE>
requesting-user-name</CODE> attribute) that submitted this file for 
printing. </P>
<P>The <I>job-id</I> field contains the job number of the page being 
printed. Job numbers are reset to 1 whenever the CUPS server is 
started, so don't depend on this number being unique! </P>
<P>The <I>date-time</I> field contains the date and time of when the 
page started printing. The format of this field is identical to the <I>
data-time</I> field in the <CODE>access_log</CODE> file. </P>
<P>The <I>page-number</I> and <I>num-pages</I> fields contain the page 
number and number of copies being printed of that page. For printer 
that can not produce copies on their own, the <I>num-pages</I> field 
will always be 1. </P>
</BODY>
</HTML>
