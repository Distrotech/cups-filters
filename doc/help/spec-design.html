<HTML>
<!-- SECTION: Specifications -->
<HEAD>
	<TITLE>CUPS Design Description</TITLE>
</HEAD>
<BODY>

<P>Like most printing systems, CUPS is designed around a central
print scheduling process that dispatches print jobs, processes
administrative commands, provides printer status information to
local and remote programs, and informs users as needed. Figure 1
shows the basic organization of CUPS.</P>

<H3>Scheduler</H3>

<P>The scheduler is a HTTP/1.1 server application that handles
HTTP requests. Besides handling printer requests via IPP POST
requests, the scheduler also acts as a full-featured web server
for documentation, status monitoring, and administration.</P>

<P>The scheduler also manages a list of available printers on
the LAN and dispatches print jobs as needed using the
appropriate filters and backends.</P>

<H3>Configuration Files</H3>

<P>The configuration files consist of:</P>

<ul>

	<LI>The HTTP server configuration file.</LI>

	<LI>Printer and class definition files.</LI>

	<LI>MIME type and conversion rule files.</LI>

	<LI>PostScript Printer Description (PPD) files.</LI>

</ul>

<P>The HTTP server configuration file is purposely similar to
the Apache server configuration file and defines all of the
access control properties for the server.</P>

<P>The printer and class definition files list the available
printer queues and classes. Printer classes are collections of
printers. Jobs sent to a class are forwarded to the first
available printer in the class, round-robin fashion.</P>

<P>The MIME type files list the supported MIME types
(text/plain, application/postscript, etc.) and "magic' rules for
automatically detecting the format of a file.  These are used by
the HTTP server to determine the <tt>Content-Type</tt> field for
<tt>GET</tt> and <tt>HEAD</tt> requests and by the IPP request
handler to determine the file type when a <tt>Print-Job</tt> or
<tt>Send-File</tt> request is received with a
<tt>document-format</tt> of
<tt>application/octet-stream</tt>.</P>

<P>The MIME conversion rule files list the available filters.
The filters are used when a job is dispatched so that an
application can send a convenient file format to the printing
system which then converts the document into a printable format
as needed. Each filter has a relative cost associated with it,
and the filtering algorithm chooses the set of filters that will
convert the file to the needed format with the lowest total
"cost".</P>

<P>The PPD files describe the capabilities of all printers, not
just PostScript printers. There is one PPD file for each
printer. PPD files for non-PostScript printers define additional
filters through <tt>cupsFilter</tt> attributes to support
printer drivers.</P>

<P ALIGN="CENTER"><IMG SRC="../images/cups-block-diagram.gif"
WIDTH="768" HEIGHT="768" ALT="CUPS Block Diagram"/><BR>
<I>Figure 1 - CUPS Block Diagram</I></P>

<H3>CUPS API</H3>

<P>The CUPS API contains CUPS-specific convenience functions for
queuing print jobs, getting printer information, accessing
resources via HTTP and IPP, and manipulating PPD files. Unlike
the rest of CUPS, the CUPS API is provided under the terms of
the GNU LGPL so it may be used by non-GPL applications.</P>

<H3>Berkeley and System V Commands</H3>

<P>CUPS provides the System V and Berkeley command-line
interfaces for submitting jobs and checking the printer status.
The <tt>lpstat</tt> and <tt>lpc status</tt> commands
also show network printers ("printer@server") when printer
browsing is enabled.</P>

<P>The System V administation commands are supplied for managing
printers and classes. The Berkeley printer administration tool
(<tt>lpc</tt>) is only supported in a "read-only' mode to
check the current status of the printer queues and
scheduler.</P>

<H3>Filters</H3>

<P>A filter program reads from the standard input or from a file
if a filename is supplied. All filters must support a common set
of options including printer name, job ID, username, job title,
number of copies, and job options. All output is sent to the
standard output.</P>

<P>Filters are provided for many file formats and include image
file and PostScript raster filters that support non-PostScript
printers. Multiple filters are run in parallel to produce the
required output format.</P>

<P>The PostScript raster filter is based on the ESP Ghostscript
core. Instead of using the Ghostscript printer drivers, the CUPS
filter uses a generic CUPS raster printer driver and
CUPS-compliant front-end to support any kind of raster printer.
This allows the same printer driver filter to be used for
printing raster data from any filter.</P>

<pre>Talk about Apple's use of CUPS...</pre>

<H3>CUPS Imaging</H3>

<P>The CUPS Imaging library provides functions for managing
large images, doing colorspace conversion and color management,
scaling images for printing, and managing raster page streams.
It is used by the CUPS image file filters, the PostScript RIP,
and all raster printers drivers.</P>

<H3>Backends</H3>

<P>A backend program is a special filter that sends print data
to a device or network connection. Backends for parallel,
serial, USB, LPD, IPP, and AppSocket (JetDirect) connections are
provided in CUPS 1.2.</P>

<P>SAMBA version 2.0.6 and higher includes a SMB backend
(<tt>smbspool(1)</tt>) that can be used for printing to
Windows.</P>

<H2 CLASS="title">Network Printing</H2>

<P>Traditionally, network printing has been one of the hardest
things to get working under UNIX. One reason is because each
vendor added their own extensions to the LPD protocol (the
previous standard for network printing), making cross-platform
printing difficult if not impossible.</P>

<P>Another reason is that you have to administer every network
printer on every client machine. In some cases you can "clone'
the printer configuration from a "master' client to each of the
others, but even that can be time-consuming and error-prone.
Something better is needed.</P>

<P>CUPS provides "printer browsing", which allows clients to
automatically see and use printers from any server on a LAN.
This means that you only need to configure the server and the
clients will automatically see the printers and classes on
it.</P>

<P>In addition, CUPS can automatically merge multiple identical
network printers into "implicit classes". This allows clients to
send jobs to the implicit class and have them print on the first
available printer or server. In addition, failsafe and
load-balancing functions are enabled simply by defining the same
printer on multiple servers!</P>

</BODY>
</HTML>
