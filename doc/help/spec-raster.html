<HTML>
<!-- SECTION: Specifications -->
<HEAD>
	<TITLE>CUPS Raster Format</TITLE>
</HEAD>
<BODY>

<P>CUPS raster files are device-dependent raster image files that
contain a PostScript page device dictionary and device-dependent
raster imagery for each page in the document. These files are
used to transfer raster data from the PostScript and image file
RIPs to device-dependent filters that convert the raster data to
a printable format.</P>

<P>CUPS 1.0 and 1.1 used a version 1 raster format. CUPS 1.2
introduces a version 2 format that is a superset of the version 1
format. Applications using the CUPS Imaging API (the cupsRaster*
functions) can read both formats without code changes.</P>

<P>The registered MIME media type for CUPS raster files is
<CODE>application/vnd.cups-raster</CODE>.</P>


<H2 CLASS="title"><A NAME="V1">Version 1 Raster File Format</A></H2>

<P>A version 1 raster file begins with a 32-bit synchronization
word: 0x52615374 ("RaSt") for big-endian architectures and
0x74536152 ("tSaR") for little-endian architectures. The writer
of the raster file will use the native word order, and the reader
is responsible for detecting a reversed word order file and
swapping bytes as needed. The CUPS Imaging API raster functions
perform this function automatically.</P>

<P>Following the synchronization word are a series of raster
pages. Each page starts with a page device dictionary header and
is followed immediately by the (uncompressed, raw) raster data
for that page.</P>

<DIV CLASS="table"><TABLE SUMMARY="CUPS Version 1 Raster Page Device Dictionary">
<CAPTION>Table 1: CUPS Version 1 Raster Page Device Dictionary</CAPTION>
<TR>
	<TH>Bytes</TH>
	<TH>Type</TH>
	<TH>Description</TH>
	<TH>Values</TH>
</TR>
<TR>
	<TD>0-63</TD>
	<TD>C String</TD>
	<TD>MediaClass</TD>
	<TD>Media class string</TD>
</TR>
<TR>
	<TD>64-127</TD>
	<TD>C String</TD>
	<TD>MediaColor</TD>
	<TD>Media color string</TD>
</TR>
<TR>
	<TD>128-191</TD>
	<TD>C String</TD>
	<TD>MediaType</TD>
	<TD>Media type string</TD>
</TR>
<TR>
	<TD>192-255</TD>
	<TD>C String</TD>
	<TD>OutputType</TD>
	<TD>Output type string</TD>
</TR>
<TR>
	<TD>256-259</TD>
	<TD>Unsigned Integer</TD>
	<TD>AdvanceDistance</TD>
	<TD>0 to 2<SUP>32</SUP> - 1 points</TD>
</TR>
<TR>
	<TD>260-263</TD>
	<TD>Unsigned Integer</TD>
	<TD>AdvanceMedia</TD>
	<TD>0 = Never advance roll<BR>
	1 = Advance roll after file<BR>
	2 = Advance roll after job<BR>
	3 = Advance roll after set<BR>
	4 = Advance roll after page</TD>
</TR>
<TR>
	<TD>264-267</TD>
	<TD>Unsigned Integer</TD>
	<TD>Collate</TD>
	<TD>0 = do not collate copies<BR>
	1 = collate copies</TD>
</TR>
<TR>
	<TD>268-271</TD>
	<TD>Unsigned Integer</TD>
	<TD>CutMedia</TD>
	<TD>0 = Never cut media<BR>
	1 = Cut roll after file<BR>
	2 = Cut roll after job<BR>
	3 = Cut roll after set<BR>
	4 = Cut roll after page</TD>
</TR>
<TR>
	<TD>272-275</TD>
	<TD>Unsigned Integer</TD>
	<TD>Duplex</TD>
	<TD>0 = Print single-sided<BR>
	1 = Print double-sided</TD>
</TR>
<TR>
	<TD>276-283</TD>
	<TD>Unsigned Integers (2)</TD>
	<TD>HWResolution</TD>
	<TD>Horizontal and vertical resolution in dots-per-inch.</TD>
</TR>
<TR>
	<TD>284-299</TD>
	<TD>Unsigned Integers (4)</TD>
	<TD>ImagingBoundingBox</TD>
	<TD>Four integers giving the left, bottom, right, and top positions
	of the page bounding box in points</TD>
</TR>
<TR>
	<TD>300-303</TD>
	<TD>Unsigned Integer</TD>
	<TD>InsertSheet</TD>
	<TD>0 = Do not insert separator sheets<BR>
	1 = Insert separator sheets</TD>
</TR>
<TR>
	<TD>304-307</TD>
	<TD>Unsigned Integer</TD>
	<TD>Jog</TD>
	<TD>0 = Do no jog pages<BR>
	1 = Jog pages after file<BR>
	2 = Jog pages after job<BR>
	3 = Jog pages after set</TD>
</TR>
<TR>
	<TD>308-311</TD>
	<TD>Unsigned Integer</TD>
	<TD>LeadingEdge</TD>
	<TD>0 = Top edge is first<BR>
	1 = Right edge is first<BR>
	2 = Bottom edge is first<BR>
	3 = Left edge is first</TD>
</TR>
<TR>
	<TD>312-319</TD>
	<TD>Unsigned Integers (2)</TD>
	<TD>Margins</TD>
	<TD>Left and bottom origin of image in points</TD>
</TR>
<TR>
	<TD>320-323</TD>
	<TD>Unsigned Integer</TD>
	<TD>ManualFeed</TD>
	<TD>0 = Do not manually feed media<BR>
	1 = Manually feed media</TD>
</TR>
<TR>
	<TD>324-327</TD>
	<TD>Unsigned Integer</TD>
	<TD>MediaPosition</TD>
	<TD>Input slot position from 0 to N</TD>
</TR>
<TR>
	<TD>328-331</TD>
	<TD>Unsigned Integer</TD>
	<TD>MediaWeight</TD>
	<TD>Media weight in grams per meter squared</TD>
</TR>
<TR>
	<TD>332-335</TD>
	<TD>Unsigned Integer</TD>
	<TD>MirrorPrint</TD>
	<TD>0 = Do not mirror prints<BR>
	1 = Mirror prints</TD>
</TR>
<TR>
	<TD>336-339</TD>
	<TD>Unsigned Integer</TD>
	<TD>NegativePrint</TD>
	<TD>0 = Do not invert prints<BR>
	1 = Invert prints</TD>
</TR>
<TR>
	<TD>340-343</TD>
	<TD>Unsigned Integer</TD>
	<TD>NumCopies</TD>
	<TD>1 to 2<SUP>32</SUP> - 1</TD>
</TR>
<TR>
	<TD>344-347</TD>
	<TD>Unsigned Integer</TD>
	<TD>Orientation</TD>
	<TD>0 = Do not rotate page<BR>
	1 = Rotate page counter-clockwise<BR>
	2 = Turn page upside down<BR>
	3 = Rotate page clockwise</TD>
</TR>
<TR>
	<TD>348-351</TD>
	<TD>Unsigned Integer</TD>
	<TD>OutputFaceUp</TD>
	<TD>0 = Output face down<BR>
	1 = Output face up</TD>
</TR>
<TR>
	<TD>352-359</TD>
	<TD>Unsigned Integers (2)</TD>
	<TD>PageSize</TD>
	<TD>Width and length in points</TD>
</TR>
<TR>
	<TD>360-363</TD>
	<TD>Unsigned Integer</TD>
	<TD>Separations</TD>
	<TD>0 = Print composite image<BR>
	1 = Print color separations</TD>
</TR>
<TR>
	<TD>364-367</TD>
	<TD>Unsigned Integer</TD>
	<TD>TraySwitch</TD>
	<TD>0 = Do not change trays if selected tray is empty<BR>
	1 = Change trays if selected tray is empty</TD>
</TR>
<TR>
	<TD>368-371</TD>
	<TD>Unsigned Integer</TD>
	<TD>Tumble</TD>
	<TD>0 = Do not rotate even pages when duplexing<BR>
	1 = Rotate even pages when duplexing</TD>
</TR>
<TR>
	<TD>372-375</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsWidth</TD>
	<TD>Width of page image in pixels</TD>
</TR>
<TR>
	<TD>376-379</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsHeight</TD>
	<TD>Height of page image in pixels</TD>
</TR>
<TR>
	<TD>380-383</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsMediaType</TD>
	<TD>Driver-specific 0 to 2<SUP>32</SUP> - 1</TD>
</TR>
<TR>
	<TD>384-387</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsBitsPerColor</TD>
	<TD>1, 2, 4, 8 bits for version 1 raster files<BR>
	1, 2, 4, 8, and 16 bits for version 2 raster files</TD>
</TR>
<TR>
	<TD>388-391</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsBitsPerPixel</TD>
	<TD>1 to 32 bits for version 1 raster files<BR>
	1 to 64 bits for version 2 raster files</TD>
</TR>
<TR>
	<TD>392-395</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsBytesPerLine</TD>
	<TD>1 to 2<SUP>32</SUP> - 1 bytes</TD>
</TR>
<TR>
	<TD>396-399</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsColorOrder</TD>
	<TD>0 = chunky pixels (CMYK CMYK CMYK)<BR>
	1 = banded pixels (CCC MMM YYY KKK)<BR>
	2 = planar pixels (CCC... MMM... YYY... KKK...)</TD>
</TR>
<TR>
	<TD>400-403</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsColorSpace</TD>
	<TD>0 = white<BR>
	1 = RGB<BR>
	2 = RGBA<BR>
	3 = black<BR>
	4 = CMY<BR>
	5 = YMC<BR>
	6 = CMYK<BR>
	7 = YMCK<BR>
	8 = KCMY<BR>
	9 = KCMYcm<BR>
	10 = GMCK<BR>
	11 = GMCS<BR>
	12 = WHITE<BR>
	13 = GOLD<BR>
	14 = SILVER<BR>
	15 = CIE XYZ<BR>
	16 = CIE Lab<BR>
	17 = RGBW<BR>
	32 = ICC1<BR>
	33 = ICC2<BR>
	34 = ICC3<BR>
	35 = ICC4<BR>
	36 = ICC5<BR>
	37 = ICC6<BR>
	38 = ICC7<BR>
	39 = ICC8<BR>
	40 = ICC9<BR>
	41 = ICCA (10)<BR>
	42 = ICCB (11)<BR>
	43 = ICCC (12)<BR>
	44 = ICCD (13)<BR>
	45 = ICCE (14)<BR>
	46 = ICCF (15)<BR>
	</TD>
</TR>
<TR>
	<TD>404-407</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsCompression</TD>
	<TD>Driver-specific 0 to 2<SUP>32</SUP> - 1</TD>
</TR>
<TR>
	<TD>408-411</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsRowCount</TD>
	<TD>Driver-specific 0 to 2<SUP>32</SUP> - 1</TD>
</TR>
<TR>
	<TD>412-415</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsRowFeed</TD>
	<TD>Driver-specific 0 to 2<SUP>32</SUP> - 1</TD>
</TR>
<TR>
	<TD>416-419</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsRowStep</TD>
	<TD>Driver-specific 0 to 2<SUP>32</SUP> - 1</TD>
</TR>
</TABLE></DIV>


<H2 CLASS="title"><A NAME="V2">Version 2 Raster File Format</A></H2>

<P>A version 2 raster file begins with a 32-bit synchronization
word: 0x52615332 ("RaS2") for big-endian architectures and
0x32536152 ("2SaR") for little-endian architectures. The writer
of the raster file will use the native word order, and the reader
is responsible for detecting a reversed word order file and
swapping bytes as needed. The CUPS Imaging API raster functions
perform this function automatically.</P>

<P>Following the synchronization word are a series of raster
pages. Each page starts with a version 2 page device dictionary
header and is followed immediately by the compressed raster data
for that page.</P>

<DIV CLASS="table"><TABLE SUMMARY="CUPS Version 2 Raster Page Device Dictionary">
<CAPTION>Table 2: CUPS Version 2 Raster Page Device Dictionary</CAPTION>
<TR>
	<TH>Bytes</TH>
	<TH>Type</TH>
	<TH>Description</TH>
	<TH>Values</TH>
</TR>
<TR>
	<TD>0-419</TD>
	<TD>Version 1 header data</TD>
	<TD>See Table 1</TD>
</TR>
<TR>
	<TD>420-423</TD>
	<TD>Unsigned Integer</TD>
	<TD>cupsNumColors</TD>
	<TD>1 to 6 colors</TD>
</TR>
<TR>
	<TD>424-427</TD>
	<TD>IEEE Single Precision</TD>
	<TD>cupsBorderlessScalingFactor</TD>
	<TD>0.0 or 1.0 or greater</TD>
</TR>
<TR>
	<TD>428-435</TD>
	<TD>IEEE Single Precision (2)</TD>
	<TD>cupsPageSize</TD>
	<TD>Width and length in points</TD>
</TR>
<TR>
	<TD>436-451</TD>
	<TD>IEEE Single Precision (4)</TD>
	<TD>cupsImagingBBox</TD>
	<TD>Four floating point numbers giving the left, bottom,
	right, and top positions of the page bounding box in
	points</TD>
</TR>
<TR>
	<TD>452-515</TD>
	<TD>Unsigned Integers (16)</TD>
	<TD>cupsInteger</TD>
	<TD>16 driver-defined integer values</TD>
</TR>
<TR>
	<TD>516-579</TD>
	<TD>IEEE Single Precision (16)</TD>
	<TD>cupsReal</TD>
	<TD>16 driver-defined floating point values</TD>
</TR>
<TR>
	<TD>580-1603</TD>
	<TD>C Strings (16x64)</TD>
	<TD>cupsString</TD>
	<TD>16 driver-defined strings</TD>
</TR>
<TR>
	<TD>1604-1667</TD>
	<TD>C String</TD>
	<TD>cupsMarkerType</TD>
	<TD>Ink/toner type string</TD>
</TR>
<TR>
	<TD>1668-1731</TD>
	<TD>C String</TD>
	<TD>cupsRenderingIntent</TD>
	<TD>Color rendering intent string</TD>
</TR>
<TR>
	<TD>1732-1795</TD>
	<TD>C String</TD>
	<TD>cupsPageSizeName</TD>
	<TD>Page size name/keyword string from PPD</TD>
</TR>
</TABLE></DIV>

<H3><A NAME="COMPRESSION">Compressed Raster Data Format</A></H3>

<P>The version 2 raster data is compressed using a modified TIFF
packbits algorithm. Lines are grouped into an integral number of
color values based upon the <CODE>cupsColorOrder</CODE>
setting:</P>

<DIV CLASS="table"><TABLE SUMMARY="Color Value Sizes">
<TR>
	<TH>cupsColorOrder</TH>
	<TH>Bytes per color value</TH>
</TR>
<TR>
	<TD>0 (chunky)</TD>
	<TD>(<CODE>cupsBitsPerPixel</CODE> + 7) / 8</TD>
</TR>
<TR>
	<TD>1 (banded)</TD>
	<TD>(<CODE>cupsBitsPerColor</CODE> + 7) / 8</TD>
</TR>
<TR>
	<TD>2 (planar)</TD>
	<TD>(<CODE>cupsBitsPerColor</CODE> + 7) / 8</TD>
</TR>
</TABLE></DIV>

<P>Each line of raster data begins with a repetition count from 1
to 256 that is encoded using a single byte of "count - 1".</P>

<P>After the repetition count, whole color values for that line
are run-length encoded using the TIFF packbits algorithm. 1 to
128 repeated colors are encoded using an initial byte of "count -
1" followed by the color value byte(s). 2 to 128 non-repeating
colors are encoded using an initial byte of "257 - count"
followed by the color value bytes.</P>



<H2 CLASS="title"><A NAME="HISTORY">Change History</A></H2>

<H3>Changes in CUPS 1.2</H3>

<ul>

	<li>Bumped raster version to 2</li>

	<li>Added RGBW colorspace</li>

	<li>Added 16 bit per color support</li>

	<li>Added cupsNumColors, cupsBorderlessScalingFactor,
	cupsPageSize, cupsImagingBBox, cupsInteger, cupsReal,
	cupsString, cupsMarkerType, cupsRenderingIntent, and
	cupsPageSizeName attributes to the page device
	dictionary</li>

	<li>Added raster data compression</li>

	<li>Added data type column to device dictionary
	documentation.</li>

</ul>

<h3>Changes in CUPS 1.1.19</h3>

<ul>

	<li>Added ICC and CIE colorspaces.</li>

</ul>

</BODY>
</HTML>
